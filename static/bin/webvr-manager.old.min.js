!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){var b=a.context.canvas.width,c=a.context.canvas.height,d={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1,depthBuffer:!1};return new THREE.WebGLRenderTarget(b,c,d)}function e(a){var b=g.getLeftEyeCenter(),c=g.getRightEyeCenter();h.leftCenter={type:"v2",value:new THREE.Vector2(b.x,b.y)},h.rightCenter={type:"v2",value:new THREE.Vector2(c.x,c.y)},window.WEBVR_BACKGROUND_COLOR&&(h.uniforms.background={type:"v4",value:window.WEBVR_BACKGROUND_COLOR});var e=new i(h),f=null,j=a.render,k=a.setSize,l=!1;this.patch=function(){l&&(f=d(a),a.render=function(b,c,d,e){j.call(a,b,c,f,e)},a.setSize=function(b,c){k.call(a,b,c),f=d(a)})},this.unpatch=function(){l&&(a.render=j,a.setSize=k)},this.preRender=function(){l&&a.setRenderTarget(f)},this.postRender=function(){if(l){var b=a.getSize();a.setViewport(0,0,b.width,b.height),e.render(j.bind(a),f)}},this.setActive=function(a){l=a}}var f=a("./device-info.js"),g=new f,h={uniforms:{tDiffuse:{type:"t",value:null},distortion:{type:"v2",value:new THREE.Vector2(.441,.156)},leftCenter:{type:"v2",value:new THREE.Vector2(.5,.5)},rightCenter:{type:"v2",value:new THREE.Vector2(.5,.5)},background:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},vertexShader:["varying vec2 vUV;","void main() {","vUV = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 distortion;","uniform vec2 leftCenter;","uniform vec2 rightCenter;","uniform vec4 background;","varying vec2 vUV;","float poly(float val) {","return 1.0 + (distortion.x + distortion.y * val) * val;","}","vec2 barrel(vec2 v, vec2 center) {","vec2 w = v - center;","return poly(dot(w, w)) * w + center;","}","void main() {","bool isLeft = (vUV.x < 0.5);","float offset = isLeft ? 0.0 : 0.5;","vec2 a = barrel(vec2((vUV.x - offset) / 0.5, vUV.y), isLeft ? leftCenter : rightCenter);","if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {","gl_FragColor = background;","} else {","gl_FragColor = texture2D(tDiffuse, vec2(a.x * 0.5 + offset, a.y));","}","}"].join("\n")},i=function(a){this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({defines:a.defines||{},uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad),this.render=function(a,b){this.uniforms.tDiffuse.value=b,this.quad.material=this.material,a(this.scene,this.camera)}};b.exports=e},{"./device-info.js":2}],2:[function(a,b,c){function d(){this.device=this.determineDevice_(),this.enclosure=i.CardboardV1}function e(a){this.width=a.width,this.height=a.height,this.widthMm=a.widthMm,this.heightMm=a.heightMm,this.bevelMm=a.bevelMm}function f(a){this.k1=a.k1,this.k2=a.k2,this.ipdMm=a.ipdMm,this.baselineLensCenterMm=a.baselineLensCenterMm}var g=a("./util.js"),h={iPhone5:new e({width:640,height:1136,widthMm:51.27,heightMm:90.11,bevelMm:3.96}),iPhone6:new e({width:750,height:1334,widthMm:58.4,heightMm:103.8,bevelMm:3.71}),iPhone6Plus:new e({width:1242,height:2208,widthMm:69.54,heightMm:122.35,bevelMm:4.62})},i={CardboardV1:new f({ipdMm:61,baselineLensCenterMm:37.26}),FunkyMonkey:new f({})},j={x:.5,y:.5},k={x:.5,y:.5};d.prototype.getLeftEyeCenter=function(){if(!this.device)return j;var a=this.enclosure.ipdMm/2,b=this.enclosure.baselineLensCenterMm,c=this.device.heightMm/2,d=this.device.widthMm,e=b-this.device.bevelMm,f=1-a/c,g=1-e/d;return{x:f,y:g}},d.prototype.getRightEyeCenter=function(){if(!this.device)return k;var a=this.getLeftEyeCenter();return{x:1-a.x,y:a.y}},d.prototype.determineDevice_=function(){if(!g.isIOS())return null;var a=(navigator.userAgent||navigator.vendor||window.opera,screen.availWidth),b=screen.availHeight,c=a*window.devicePixelRatio,d=b*window.devicePixelRatio;for(var e in h){var f=h[e];if(f.width==c||f.width==d)return console.log("Detected iPhone: %s",e),f}return null},b.exports=d},{"./util.js":6}],3:[function(a,b,c){function d(){this.callbacks={}}d.prototype.emit=function(a){var b=this.callbacks[a];if(!b)return void console.log("No valid callback specified.");var c=[].slice.call(arguments);c.shift();for(var d=0;d<b.length;d++)b[d].apply(this,c)},d.prototype.on=function(a,b){a in this.callbacks?this.callbacks[a].push(b):this.callbacks[a]=[b]},b.exports=d},{}],4:[function(a,b,c){var d=a("./webvr-manager.js");window.WebVRManager=d},{"./webvr-manager.js":9}],5:[function(a,b,c){var d={UNKNOWN:0,INCOMPATIBLE:1,COMPATIBLE:2,VR:3};b.exports=d},{}],6:[function(a,b,c){var d={};d.base64=function(a,b){return"data:"+a+";base64,"+b},d.isMobile=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a},d.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},b.exports=d},{}],7:[function(a,b,c){function d(){var a=document.createElement("video");a.addEventListener("ended",function(){a.play()}),this.request=function(){},this.release=function(){}}function e(){var a=null;this.request=function(){a||(a=setInterval(function(){window.location=window.location,setTimeout(window.stop,0)},3e4))},this.release=function(){a&&(clearInterval(a),a=null)}}function f(){var a=navigator.userAgent||navigator.vendor||window.opera;return a.match(/iPhone/i)||a.match(/iPod/i)?e:d}a("./util.js");b.exports=f()},{"./util.js":6}],8:[function(a,b,c){function d(){var a=this.createButton();document.body.appendChild(a),a.addEventListener("click",this.onClick_.bind(this)),this.button=a,this.isVisible=!0,this.logoCardboard=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMjAuNzQgNkgzLjIxQzIuNTUgNiAyIDYuNTcgMiA3LjI4djEwLjQ0YzAgLjcuNTUgMS4yOCAxLjIzIDEuMjhoNC43OWMuNTIgMCAuOTYtLjMzIDEuMTQtLjc5bDEuNC0zLjQ4Yy4yMy0uNTkuNzktMS4wMSAxLjQ0LTEuMDFzMS4yMS40MiAxLjQ1IDEuMDFsMS4zOSAzLjQ4Yy4xOS40Ni42My43OSAxLjExLjc5aDQuNzljLjcxIDAgMS4yNi0uNTcgMS4yNi0xLjI4VjcuMjhjMC0uNy0uNTUtMS4yOC0xLjI2LTEuMjh6TTcuNSAxNC42MmMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTMgMS4xOCAwIDIuMTIuOTYgMi4xMiAyLjEzcy0uOTUgMi4xMi0yLjEyIDIuMTJ6bTkgMGMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTNzMi4xMi45NiAyLjEyIDIuMTMtLjk1IDIuMTItMi4xMiAyLjEyeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo="),this.logoFullscreen=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNyAxNEg1djVoNXYtMkg3di0zem0tMi00aDJWN2gzVjVINXY1em0xMiA3aC0zdjJoNXYtNWgtMnYzek0xNCA1djJoM3YzaDJWNWgtNXoiLz4KPC9zdmc+Cg=="),this.logoExit=g.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNSAxNmgzdjNoMnYtNUg1djJ6bTMtOEg1djJoNVY1SDh2M3ptNiAxMWgydi0zaDN2LTJoLTV2NXptMi0xMVY1aC0ydjVoNVY4aC0zeiIvPgo8L3N2Zz4K")}var e=a("./modes.js"),f=a("./emitter.js"),g=a("./util.js");d.prototype=new f,d.prototype.createButton=function(){var a=document.createElement("img"),b=a.style;return b.position="absolute",b.bottom="5px",b.left=0,b.right=0,b.marginLeft="auto",b.marginRight="auto",b.width="56px",b.height="56px",b.backgroundSize="cover",b.backgroundColor="transparent",b.border=0,b.userSelect="none",b.webkitUserSelect="none",b.MozUserSelect="none",b.cursor="pointer",a.draggable=!1,a.addEventListener("dragstart",function(a){a.preventDefault()}),a},d.prototype.setMode=function(a){if(this.isVisible){switch(a){case e.INCOMPATIBLE:this.button.src=this.logoFullscreen,this.button.title="Open in immersive mode";break;case e.COMPATIBLE:this.button.src=this.logoCardboard,this.button.title="Open in VR mode";break;case e.VR:this.button.src=this.logoExit,this.button.title="Leave VR mode"}this.button.style.display="inline-block",this.button.offsetHeight,this.button.style.display="block"}},d.prototype.setVisibility=function(a){this.isVisible=a,this.button.style.display=a?"block":"none"},d.prototype.onClick_=function(a){a.stopPropagation(),a.preventDefault(),this.emit("click")},b.exports=d},{"./emitter.js":3,"./modes.js":5,"./util.js":6}],9:[function(a,b,c){function d(a,b,c){this.params=c||{},this.mode=g.UNKNOWN;var d=this.params.hideButton||!1;this.renderer=a,this.effect=b,this.distorter,this.button=new f,d&&this.button.setVisibility(!1),this.getDeviceByType_(HMDVRDevice).then(function(b){window.WEBVR_FORCE_DISTORTION?(this.activateVR_(),this.distorter=new e(a),this.distorter.setActive(!0)):b?(this.activateVR_(),0==b.deviceName.indexOf("webvr-polyfill")&&h.isIOS()&&(this.distorter=new e(a),this.distorter.setActive(!0))):this.activateImmersive_(),this.defaultMode=b?g.COMPATIBLE:g.INCOMPATIBLE,this.button.setMode(this.defaultMode)}.bind(this)),this.getDeviceByType_(PositionSensorVRDevice).then(function(a){this.input=a}.bind(this))}var e=(a("./wakelock.js"),a("./cardboard-distorter.js")),f=a("./webvr-button.js"),g=a("./modes.js"),h=a("./util.js");d.prototype.getDeviceByType_=function(a){return new Promise(function(b,c){navigator.getVRDevices().then(function(c){for(var d=0;d<c.length;d++)if(c[d]instanceof a){b(c[d]);break}b(null)},function(){b(null)})})},d.prototype.isVRMode=function(){return this.mode==g.VR},d.prototype.render=function(a,b,c){this.isVRMode()?this.distorter?(this.distorter.preRender(),this.effect.render(a,b),this.distorter.postRender()):this.effect.render(a,b):a instanceof Array?this.renderer.render(a[0],b):this.renderer.render(a,b),this.input&&this.input.setAnimationFrameTime&&this.input.setAnimationFrameTime(c)},d.prototype.activateVR_=function(){this.button.on("click",this.toggleVRMode.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullscreenChange_.bind(this))},d.prototype.activateImmersive_=function(){this.button.on("click",this.enterImmersive.bind(this))},d.prototype.enterImmersive=function(){this.requestPointerLock_(),this.requestFullscreen_()},d.prototype.toggleVRMode=function(){this.isVRMode()?this.exitVR():(this.requestPointerLock_(),this.enterVR())},d.prototype.onFullscreenChange_=function(a){(null===document.webkitFullscreenElement||null===document.mozFullScreenElement)&&this.exitVR()},d.prototype.requestPointerLock_=function(){var a=this.renderer.domElement;a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock&&a.requestPointerLock()},d.prototype.releasePointerLock_=function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},d.prototype.requestOrientationLock_=function(){screen.orientation&&h.isMobile()&&screen.orientation.lock("landscape")},d.prototype.releaseOrientationLock_=function(){screen.orientation&&h.isMobile()&&screen.orientation.unlock()},d.prototype.requestFullscreen_=function(){var a=this.renderer.domElement;a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},d.prototype.enterVR=function(){console.log("Entering VR."),this.button.setVisibility(!1),this.effect.setFullScreen(!0),this.requestOrientationLock_(),this.mode=g.VR,this.button.setMode(this.mode),this.distorter&&this.distorter.patch()},d.prototype.exitVR=function(){console.log("Exiting VR."),this.mode=this.defaultMode,this.releaseOrientationLock_(),this.releasePointerLock_(),this.button.setMode(this.mode),this.button.setVisibility(!0),this.distorter&&this.distorter.unpatch()},b.exports=d},{"./cardboard-distorter.js":1,"./modes.js":5,"./util.js":6,"./wakelock.js":7,"./webvr-button.js":8}]},{},[4]);