(function(){Leap.plugin("transform",function(a){var b,c,d,e,f,g;null===a&&(a={}),b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],g=new THREE.Matrix4,a.vr===!0?(this.setOptimizeHMD(!0),a.quaternion=(new THREE.Quaternion).setFromRotationMatrix((new THREE.Matrix4).set(-1,0,0,0,0,0,-1,0,0,-1,0,0,0,0,0,1)),a.scale=.001,a.position=new THREE.Vector3(0,0,-.06)):"desktop"===a.vr&&(a.scale=.001);var h=new THREE.Vector3(a.scale,a.scale,a.scale).toArray();a.getTransform=function(c){return a.position||a.quaternion||a.scale?(g.set.apply(g,b),a.quaternion&&g.makeRotationFromQuaternion(a.quaternion),a.position&&g.setPosition(a.position),g.elements):b},e=function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],c?f.push(Leap.vec3.transformMat4(c,c,a)):f.push(void 0);return f},d=function(a,b,c){var d,e,f;return d=b[0],e=b[1],f=b[2],a[0]=c[0]*d+c[4]*e+c[8]*f,a[1]=c[1]*d+c[5]*e+c[9]*f,a[2]=c[2]*d+c[6]*e+c[10]*f,a},c=function(a,b){var c,e,f,g;for(g=[],e=0,f=b.length;f>e;e++)c=b[e],c?g.push(d(c,c,a)):g.push(void 0);return g},f=function(a,b,d){var f,g,h,i,j,k,l,m;for(c(b,[a.direction,a.palmNormal,a.palmVelocity,a.arm.basis[0],a.arm.basis[1],a.arm.basis[2]]),l=a.fingers,h=0,j=l.length;j>h;h++)f=l[h],c(b,[f.direction,f.metacarpal.basis[0],f.metacarpal.basis[1],f.metacarpal.basis[2],f.proximal.basis[0],f.proximal.basis[1],f.proximal.basis[2],f.medial.basis[0],f.medial.basis[1],f.medial.basis[2],f.distal.basis[0],f.distal.basis[1],f.distal.basis[2]]);for(Leap.glMatrix.mat4.scale(b,b,d),e(b,[a.palmPosition,a.stabilizedPalmPosition,a.sphereCenter,a.arm.nextJoint,a.arm.prevJoint]),m=a.fingers,i=0,k=m.length;k>i;i++)f=m[i],e(b,[f.carpPosition,f.mcpPosition,f.pipPosition,f.dipPosition,f.distal.nextJoint,f.tipPosition]);return g=(d[0]+d[1]+d[2])/3,a.arm.width*=g};var i=function(a,b,d){c(b,[a.direction,a.tipVelocity]),Leap.glMatrix.mat4.scale(b,b,d),e(b,[a.tipPosition,a.stabilizedTipPosition])},j=[1,1,1];return{frame:function(b){var c,d,e,g,k,l,m,n,o,p;if(b.valid&&!b.data.transformed){for(b.data.transformed=!0,n=b.hands,p=[],g=0,l=n.length;l>g;g++){for(d=n[g],f(d,a.getTransform(d),h),a.effectiveParent&&f(d,a.effectiveParent.matrix.elements,j),e=null,o=d.fingers,k=0,m=o.length;m>k;k++)c=o[k],e=Leap.vec3.create(),Leap.vec3.sub(e,c.mcpPosition,c.carpPosition),c.metacarpal.length=Leap.vec3.length(e),Leap.vec3.sub(e,c.pipPosition,c.mcpPosition),c.proximal.length=Leap.vec3.length(e),Leap.vec3.sub(e,c.dipPosition,c.pipPosition),c.medial.length=Leap.vec3.length(e),Leap.vec3.sub(e,c.tipPosition,c.dipPosition),c.distal.length=Leap.vec3.length(e);Leap.vec3.sub(e,d.arm.prevJoint,d.arm.nextJoint),p.push(d.arm.length=Leap.vec3.length(e))}if(1==b.tools.length){var q=b.tools[0];i(q,a.getTransform(d),h),a.effectiveParent&&i(q,a.effectiveParent.matrix.elements,j)}return p}}}})}).call(this);