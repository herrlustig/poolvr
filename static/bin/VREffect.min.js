THREE.VREffect=function(a,b){function c(a){for(var c=0;c<a.length;c++)if(a[c]instanceof HMDVRDevice){if(g=a[c],void 0!==g.getEyeParameters){var d=g.getEyeParameters("left"),e=g.getEyeParameters("right");h=d.eyeTranslation,j=e.eyeTranslation,i=d.recommendedFieldOfView,k=e.recommendedFieldOfView}else h=g.getEyeTranslation("left"),j=g.getEyeTranslation("right"),i=g.getRecommendedEyeFieldOfView("left"),k=g.getRecommendedEyeFieldOfView("right");this.scale=1,p.projectionMatrix=f(i,!0,.1,1e3),q.projectionMatrix=f(k,!0,.1,1e3);break}void 0===g&&b&&b("HMD not available")}function d(a){var b=2/(a.leftTan+a.rightTan),c=(a.leftTan-a.rightTan)*b*.5,d=2/(a.upTan+a.downTan),e=(a.upTan-a.downTan)*d*.5;return{scale:[b,d],offset:[c,e]}}function e(a,b,c,e){b=void 0===b?!0:b,c=void 0===c?.01:c,e=void 0===e?1e4:e;var f=b?-1:1,g=new THREE.Matrix4,h=g.elements,i=d(a);return h[0]=i.scale[0],h[1]=0,h[2]=i.offset[0]*f,h[3]=0,h[4]=0,h[5]=i.scale[1],h[6]=-i.offset[1]*f,h[7]=0,h[8]=0,h[9]=0,h[10]=e/(c-e)*-f,h[11]=e*c/(c-e),h[12]=0,h[13]=0,h[14]=f,h[15]=0,g.transpose(),g}function f(a,b,c,d){var f=Math.PI/180,g={upTan:Math.tan(a.upDegrees*f),downTan:Math.tan(a.downDegrees*f),leftTan:Math.tan(a.leftDegrees*f),rightTan:Math.tan(a.rightDegrees*f)};return e(g,b,c,d)}var g,h,i,j,k,l=new THREE.Matrix4,m=new THREE.Matrix4,n=1;Object.defineProperty(this,"scale",{get:function(){return n},set:function(a){n=a,l.makeTranslation(n*h.x,n*h.y,n*h.z),m.makeTranslation(n*j.x,n*j.y,n*j.z)}}),navigator.getVRDevices&&navigator.getVRDevices().then(c.bind(this));var o=a.domElement;this.setSize=function(b,c){a.setSize(b,c)},this.setFullScreen=function(a){void 0!==g&&(o.mozRequestFullScreen?o.mozRequestFullScreen({vrDisplay:g}):o.webkitRequestFullscreen&&o.webkitRequestFullscreen({vrDisplay:g}))};var p=new THREE.PerspectiveCamera,q=new THREE.PerspectiveCamera;p.matrixAutoUpdate=!1,q.matrixAutoUpdate=!1,this.render=function(b,c){if(g){var d,e,f;Array.isArray(b)?(d=b[0],e=b[1]):(d=b,e=b,b.autoUpdate===!0&&(b.updateMatrixWorld(),f=b.autoUpdate,b.autoUpdate=!1));var h=a.getSize();return h.width/=2,a.enableScissorTest(!0),a.clear(),null===c.parent&&c.updateMatrixWorld(),a.setViewport(0,0,h.width,h.height),a.setScissor(0,0,h.width,h.height),p.matrixWorld.multiplyMatrices(c.matrixWorld,l),a.render(d,p),a.setViewport(h.width,0,h.width,h.height),a.setScissor(h.width,0,h.width,h.height),q.matrixWorld.multiplyMatrices(c.matrixWorld,m),a.render(e,q),a.enableScissorTest(!1),void(f===!0&&(b.autoUpdate=!0))}Array.isArray(b)&&(b=b[0]),a.render(b,c)}};