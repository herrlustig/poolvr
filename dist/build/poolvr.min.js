!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){POOLVR.selectNextBall=function(inc){"use strict";inc=inc||1;var next=Math.max(1,Math.min(15,POOLVR.nextBall+inc));if(next!==POOLVR.nextBall){for(;!POOLVR.onTable[next];){var _next=next;if(next=Math.max(1,Math.min(15,next+inc)),next===_next)break}POOLVR.nextBall!==next&&(POOLVR.nextBall=next,POOLVR.textGeomLogger.log("BALL "+POOLVR.nextBall+" SELECTED"))}},POOLVR.resetTable=function(){"use strict";POOLVR.ballBodies.forEach(function(body,ballNum){body.wakeUp(),body.position.copy(POOLVR.initialPositions[ballNum]),body.velocity.set(0,0,0),body.angularVelocity.set(0,0,0),body.bounces=0,POOLVR.onTable[ballNum]=!0,body.mesh.visible=!0}),POOLVR.synthSpeaker.speaking===!1&&POOLVR.synthSpeaker.speak("Table reset."),POOLVR.nextBall=1,POOLVR.textGeomLogger.log("TABLE RESET.")},POOLVR.autoPosition=function(){"use strict";var nextVector=new THREE.Vector3,UP=THREE.Object3D.DefaultUp,speakCount=0;return function(){POOLVR.synthSpeaker.speaking===!1&&3>=speakCount&&(POOLVR.synthSpeaker.speak("You are being auto-positioned."),3===speakCount&&POOLVR.synthSpeaker.speak("I will stop saying that now."),speakCount++);var avatar=POOLVR.avatar,heading=Math.atan2(-(POOLVR.ballMeshes[POOLVR.nextBall].position.x-POOLVR.ballMeshes[0].position.x),-(POOLVR.ballMeshes[POOLVR.nextBall].position.z-POOLVR.ballMeshes[0].position.z));avatar.quaternion.setFromAxisAngle(UP,heading),nextVector.copy(POOLVR.leapTool.toolRoot.position),nextVector.applyQuaternion(avatar.quaternion),nextVector.add(avatar.position),nextVector.sub(POOLVR.ballMeshes[0].position),nextVector.y=0,avatar.position.sub(nextVector),avatar.updateMatrix(),avatar.updateMatrixWorld(),POOLVR.leapTool.updateToolMapping()}}(),POOLVR.stroke=function(){"use strict";var velocity=new THREE.Vector3;return function(){velocity.set(0,0,-3.5),velocity.applyQuaternion(POOLVR.leapTool.worldQuaternion);var body=POOLVR.ballBodies[0];body.velocity.copy(velocity)}}()},{}],2:[function(require,module,exports){POOLVR.commands={toggleMenu:function(){POOLVR.toggleMenu()},toggleVRControls:function(){POOLVR.app.toggleVRControls()},toggleVR:function(){POOLVR.app.toggleVR()},toggleWireframe:function(){POOLVR.app.toggleWireframe()},resetVRSensor:function(){POOLVR.app.resetVRSensor()},resetTable:POOLVR.resetTable,autoPosition:POOLVR.autoPosition,selectNextBall:function(){POOLVR.selectNextBall()},selectPrevBall:function(){POOLVR.selectNextBall(-1)},stroke:POOLVR.stroke},POOLVR.keyboardCommands={turnLeft:{buttons:[37]},turnRight:{buttons:[39]},driveForward:{buttons:[87]},driveBack:{buttons:[83]},strafeLeft:{buttons:[65]},strafeRight:{buttons:[68]},floatUp:{buttons:[69]},floatDown:{buttons:[67]},moveToolUp:{buttons:[79]},moveToolDown:{buttons:[190]},moveToolForwards:{buttons:[73]},moveToolBackwards:{buttons:[75]},moveToolLeft:{buttons:[74]},moveToolRight:{buttons:[76]},rotateToolCW:{buttons:[85]},rotateToolCCW:{buttons:[89]},toggleVR:{buttons:[YAWVRB.Keyboard.KEYCODES.NUMBER9],commandDown:POOLVR.commands.toggleVR},toggleWireframe:{buttons:[YAWVRB.Keyboard.KEYCODES.B],commandDown:POOLVR.commands.toggleWireframe},resetVRSensor:{buttons:[90],commandDown:POOLVR.commands.resetVRSensor},resetTable:{buttons:[82],commandDown:POOLVR.commands.resetTable},autoPosition:{buttons:[80],commandDown:POOLVR.commands.autoPosition},selectNextBall:{buttons:[107],commandDown:POOLVR.commands.selectNextBall},selectPrevBall:{buttons:[109],commandDown:POOLVR.commands.selectPrevBall},stroke:{buttons:[YAWVRB.Keyboard.KEYCODES.SPACEBAR],commandDown:POOLVR.commands.stroke},toggleMenu:{buttons:[YAWVRB.Keyboard.KEYCODES.M],commandDown:POOLVR.commands.toggleMenu}},POOLVR.keyboard=new YAWVRB.Keyboard(window,POOLVR.keyboardCommands),POOLVR.gamepadCommands={turnLR:{axes:[YAWVRB.Gamepads.AXES.LSX]},moveFB:{axes:[YAWVRB.Gamepads.AXES.LSY]},moveLR:{axes:[YAWVRB.Gamepads.AXES.RSX]},turnUD:{axes:[YAWVRB.Gamepads.AXES.RSY]},toggleFloatMode:{buttons:[YAWVRB.Gamepads.BUTTONS.leftStick]},toolTurnLR:{axes:[YAWVRB.Gamepads.AXES.RSX]},toolMoveFB:{axes:[YAWVRB.Gamepads.AXES.RSY]},toggleToolFloatMode:{buttons:[YAWVRB.Gamepads.BUTTONS.rightStick]},resetVRSensor:{buttons:[YAWVRB.Gamepads.BUTTONS.back],commandDown:POOLVR.commands.resetVRSensor},selectNextBall:{buttons:[YAWVRB.Gamepads.BUTTONS.rightBumper],commandDown:POOLVR.commands.selectNextBall},selectPrevBall:{buttons:[YAWVRB.Gamepads.BUTTONS.leftBumper],commandDown:POOLVR.commands.selectPrevBall},stroke:{buttons:[YAWVRB.Gamepads.BUTTONS.X],commandDown:POOLVR.commands.stroke},autoPosition:{buttons:[YAWVRB.Gamepads.BUTTONS.Y],commandDown:POOLVR.commands.autoPosition},toggleMenu:{buttons:[YAWVRB.Gamepads.BUTTONS.start],commandDown:POOLVR.commands.toggleMenu}},POOLVR.vrGamepadACommands={toggleVR:{buttons:[3],commandDown:POOLVR.commands.toggleVR},toggleFloatMode:{buttons:[0]},moveLR:{axes:[YAWVRB.Gamepads.AXES.LSX]},moveFB:{axes:[YAWVRB.Gamepads.AXES.LSY],flipAxes:!0},autoPosition:{buttons:[2],commandDown:POOLVR.commands.autoPosition}},POOLVR.vrGamepadBCommands={toolTurnLR:{axes:[YAWVRB.Gamepads.AXES.LSX]},toolMoveFB:{axes:[YAWVRB.Gamepads.AXES.LSY],flipAxes:!0},toggleToolFloatMode:{buttons:[0]},resetVRSensor:{buttons:[3],commandDown:POOLVR.commands.resetVRSensor},resetTable:{buttons:[2],commandDown:POOLVR.commands.resetTable}},POOLVR.parseURIConfig=function(){"use strict";POOLVR.config=POOLVR.config||{},POOLVR.config.useBasicMaterials?(POOLVR.config.useSpotLight=!1,POOLVR.config.usePointLight=!1,POOLVR.config.useShadowMap=!1):(POOLVR.config.useSpotLight=void 0!==YAWVRB.Utils.URL_PARAMS.useSpotLight?YAWVRB.Utils.URL_PARAMS.useSpotLight:POOLVR.config.useSpotLight||!0,POOLVR.config.usePointLight=void 0!==YAWVRB.Utils.URL_PARAMS.usePointLight?YAWVRB.Utils.URL_PARAMS.usePointLight:POOLVR.config.usePointLight,POOLVR.config.useShadowMap=void 0!==YAWVRB.Utils.URL_PARAMS.useShadowMap?YAWVRB.Utils.URL_PARAMS.useShadowMap:POOLVR.config.useShadowMap),POOLVR.config.toolOptions=POOLVR.config.toolOptions||{},POOLVR.config.toolOptions.useShadowMesh=!POOLVR.config.useShadowMap,POOLVR.config.toolOptions.shadowPlane=POOLVR.config.H_table+.001,POOLVR.config.toolOptions.shadowMaterial=POOLVR.shadowMaterial},POOLVR.saveConfig=function(profileName){"use strict";POOLVR.stage&&(POOLVR.config.stage=POOLVR.stage.save()),localStorage.setItem(profileName,JSON.stringify(POOLVR.config,void 0,2)),console.log('saved configuration for profile "%s":',profileName),console.log(localStorage[profileName])},POOLVR.loadConfig=function(profileName){"use strict";var config,localStorageConfig=localStorage.getItem(profileName);if(localStorageConfig){config={},localStorageConfig=JSON.parse(localStorageConfig);for(var k in localStorageConfig)config[k]=localStorageConfig[k];console.log('loaded configuration for profile "%s"',profileName)}return config},function(){"use strict";var world=new CANNON.World;world.gravity.set(0,-POOLVR.config.gravity,0),world.defaultContactMaterial.contactEquationStiffness=2e7,world.defaultContactMaterial.frictionEquationStiffness=2e6,world.defaultContactMaterial.contactEquationRelaxation=2,world.defaultContactMaterial.frictionEquationRelaxation=3,world.solver.iterations=10,POOLVR.world=world,POOLVR.ballMaterial=new CANNON.Material,POOLVR.ballBallContactMaterial=new CANNON.ContactMaterial(POOLVR.ballMaterial,POOLVR.ballMaterial,{restitution:.92,friction:.14}),POOLVR.playableSurfaceMaterial=new CANNON.Material,POOLVR.ballPlayableSurfaceContactMaterial=new CANNON.ContactMaterial(POOLVR.ballMaterial,POOLVR.playableSurfaceMaterial,{restitution:.24,friction:.21,contactEquationStiffness:7e8}),POOLVR.cushionMaterial=new CANNON.Material,POOLVR.ballCushionContactMaterial=new CANNON.ContactMaterial(POOLVR.ballMaterial,POOLVR.cushionMaterial,{restitution:.8,friction:.12}),POOLVR.floorMaterial=new CANNON.Material,POOLVR.floorBallContactMaterial=new CANNON.ContactMaterial(POOLVR.floorMaterial,POOLVR.ballMaterial,{restitution:.86,friction:.4}),POOLVR.railMaterial=new CANNON.Material,POOLVR.railBallContactMaterial=new CANNON.ContactMaterial(POOLVR.railMaterial,POOLVR.ballMaterial,{restitution:.7,friction:.07}),POOLVR.tipMaterial=new CANNON.Material,POOLVR.tipBallContactMaterial=new CANNON.ContactMaterial(POOLVR.tipMaterial,POOLVR.ballMaterial,{restitution:.01,friction:.13,contactEquationRelaxation:2,frictionEquationRelaxation:2}),POOLVR.openVRTipMaterial=new CANNON.Material,POOLVR.openVRTipBallContactMaterial=new CANNON.ContactMaterial(POOLVR.openVRTipMaterial,POOLVR.ballMaterial,{restitution:1,friction:.25,contactEquationRelaxation:1,frictionEquationRelaxation:1,contactEquationStiffness:1e9,frictionEquationStiffness:1e8}),world.addMaterial(POOLVR.playableSurfaceMaterial),world.addMaterial(POOLVR.cushionMaterial),world.addMaterial(POOLVR.railMaterial),world.addMaterial(POOLVR.floorMaterial),world.addMaterial(POOLVR.ballMaterial),world.addMaterial(POOLVR.tipMaterial),world.addMaterial(POOLVR.openVRTipMaterial),world.addContactMaterial(POOLVR.ballBallContactMaterial),world.addContactMaterial(POOLVR.ballPlayableSurfaceContactMaterial),world.addContactMaterial(POOLVR.ballCushionContactMaterial),world.addContactMaterial(POOLVR.floorBallContactMaterial),world.addContactMaterial(POOLVR.railBallContactMaterial),world.addContactMaterial(POOLVR.tipBallContactMaterial),world.addContactMaterial(POOLVR.openVRTipBallContactMaterial)}(),POOLVR.shadowMaterial=new THREE.MeshBasicMaterial({color:8704})},{}],3:[function(require,module,exports){window.POOLVR=window.POOLVR||{},require("./sounds.js"),require("./actions.js"),require("./config.js"),require("./menu.js"),window.onLoad=function(){"use strict";function onGamepadConnected(e){var gamepad=e.gamepad;gamepad&&(/openvr/i.test(gamepad.id)?didA?(console.log("OpenVR controller B connected"),YAWVRB.Gamepads.setGamepadCommands(gamepad.index,POOLVR.vrGamepadBCommands)):(console.log("OpenVR controller A connected"),YAWVRB.Gamepads.setGamepadCommands(gamepad.index,POOLVR.vrGamepadACommands),openVRTool.mesh.visible=!0,openVRTool.setGamepad(gamepad),world.addBody(openVRTool.body),didA=!0):(/xbox/i.test(gamepad.id)||/xinput/i.test(gamepad.id))&&YAWVRB.Gamepads.setGamepadCommands(gamepad.index,POOLVR.gamepadCommands))}YAWVRB.Utils.URL_PARAMS.clearLocalStorage&&(console.log("clearing localStorage..."),localStorage.clear()),THREE.Object3D.DefaultMatrixAutoUpdate=!1,POOLVR.avatar=new THREE.Object3D;var avatar=POOLVR.avatar;POOLVR.config=POOLVR.loadConfig(POOLVR.profile)||POOLVR.config,POOLVR.parseURIConfig(),console.log("POOLVR.config:"),console.log(POOLVR.config),POOLVR.stage=new YAWVRB.Stage,POOLVR.objectSelector=new YAWVRB.Utils.ObjectSelector;var world=POOLVR.world;if(POOLVR.config.useTextGeomLogger){var fontLoader=new THREE.FontLoader;fontLoader.load("fonts/Anonymous Pro_Regular.js",function(font){var textGeomCacher=new YAWVRB.TextGeomUtils.TextGeomCacher(font,{size:.12,curveSegments:3}),textGeomLoggerMaterial=new THREE.MeshBasicMaterial({color:16724496});POOLVR.textGeomLogger=new YAWVRB.TextGeomUtils.TextGeomLogger(textGeomCacher,{material:textGeomLoggerMaterial,nrows:8,lineHeight:.216}),avatar.add(POOLVR.textGeomLogger.root),POOLVR.textGeomLogger.root.position.set(-2.7,.88,-3.3),POOLVR.textGeomLogger.root.updateMatrix()})}else POOLVR.textGeomLogger={root:new THREE.Object3D,log:function(msg){console.log(msg)},update:function(){},clear:function(){}};POOLVR.synthSpeaker=new YAWVRB.SynthSpeaker({volume:POOLVR.config.synthSpeakerVolume,rate:.8,pitch:.5});var openVRTool=YAWVRB.Gamepads.makeTool(YAWVRB.Utils.combineObjects(POOLVR.config.toolOptions,{toolMass:2,tipMaterial:POOLVR.openVRTipMaterial}));POOLVR.openVRTool=openVRTool,avatar.add(openVRTool.mesh),openVRTool.mesh.visible=!1;var didA=!1;YAWVRB.Gamepads.setOnGamepadConnected(onGamepadConnected),POOLVR.setupMenu(),POOLVR.leapIndicator=document.getElementById("leapIndicator");var leapTool=YAWVRB.LeapMotion.makeTool(YAWVRB.Utils.combineObjects(POOLVR.config.toolOptions,{onConnect:function(){POOLVR.leapIndicator.innerHTML="Leap Motion: websocket connected",POOLVR.leapIndicator.style["background-color"]="rgba(60, 100, 20, 0.8)"},onStreamingStarted:function(){POOLVR.leapIndicator.innerHTML="Leap Motion: websocket connected, streaming",POOLVR.leapIndicator.style["background-color"]="rgba(20, 160, 20, 0.8)"},onStreamingStopped:function(){POOLVR.leapIndicator.innerHTML="Leap Motion: websocket connected, streaming stopped",POOLVR.leapIndicator.style["background-color"]="rgba(60, 100, 20, 0.8)"},onDisconnect:function(){POOLVR.leapIndicator.innerHTML="Leap Motion: websocket disconnected",POOLVR.leapIndicator.style["background-color"]="rgba(60, 20, 20, 0.4)"},tipMaterial:POOLVR.tipMaterial}));POOLVR.leapTool=leapTool,leapTool.toolMesh.renderOrder=-1,avatar.add(leapTool.toolRoot),world.addBody(leapTool.toolBody),leapTool.leapController.connect(),POOLVR.objectSelector.addSelectable(POOLVR.leapTool.toolRoot),leapTool.toolRoot.name="toolRoot",avatar.add(POOLVR.leapTool.toolRoot);var rendererOptions={canvas:document.getElementById("webgl-canvas"),antialias:(void 0!==YAWVRB.Utils.URL_PARAMS.antialias?YAWVRB.Utils.URL_PARAMS.antialias:POOLVR.config.antialias)||!YAWVRB.Utils.isMobile()},euler=new THREE.Euler(0,0,0,"YXZ"),appConfig={onResetVRSensor:function(lastRotation,lastPosition){console.log("lastRotation: %f\nlastPosition: %s",lastRotation,JSON.stringify(lastPosition));var camera=POOLVR.app.camera,toolRoot=POOLVR.leapTool.toolRoot;euler.setFromQuaternion(toolRoot.quaternion),euler.y-=lastRotation,toolRoot.quaternion.setFromAxisAngle(THREE.Object3D.DefaultUp,euler.y),toolRoot.position.sub(lastPosition),toolRoot.position.applyAxisAngle(THREE.Object3D.DefaultUp,-lastRotation),toolRoot.position.add(camera.position),toolRoot.updateMatrix(),euler.setFromQuaternion(avatar.quaternion),euler.y+=lastRotation,avatar.quaternion.setFromAxisAngle(THREE.Object3D.DefaultUp,euler.y),avatar.updateMatrix(),avatar.updateMatrixWorld(),POOLVR.leapTool.updateToolMapping()}};POOLVR.app=new YAWVRB.App(void 0,appConfig,rendererOptions);var app=POOLVR.app;POOLVR.config.useShadowMap&&(app.renderer.shadowMap.enabled=!0),avatar.add(POOLVR.app.camera),avatar.position.set(0,.98295,1.0042),THREE.py.parse(THREEPY_SCENE).then(function(scene){scene.autoUpdate=!1,POOLVR.app.scene=scene,leapTool.toolShadowMesh&&POOLVR.app.scene.add(leapTool.toolShadowMesh),POOLVR.openVRTool&&POOLVR.openVRTool.shadowMesh&&POOLVR.app.scene.add(POOLVR.openVRTool.shadowMesh);var centerSpotLight=new THREE.SpotLight(16777198,1,8,Math.PI/2);if(centerSpotLight.position.set(0,3,0),centerSpotLight.castShadow=!0,centerSpotLight.shadow.camera.matrixAutoUpdate=!0,centerSpotLight.shadow.camera.near=1,centerSpotLight.shadow.camera.far=3,centerSpotLight.shadow.camera.fov=80,scene.add(centerSpotLight),centerSpotLight.updateMatrix(),centerSpotLight.updateMatrixWorld(),POOLVR.centerSpotLight=centerSpotLight,POOLVR.centerSpotLight.visible=POOLVR.config.useSpotLight,POOLVR.config.usePointLight){var pointLight=new THREE.PointLight(11176038,.8,40);pointLight.position.set(4,5,2.5),scene.add(pointLight),pointLight.updateMatrix(),pointLight.updateMatrixWorld()}scene.add(avatar),avatar.updateMatrix(),avatar.updateMatrixWorld(),THREE.py.CANNONize(scene,world),POOLVR.ballMeshes=[],POOLVR.ballBodies=[],POOLVR.initialPositions=[],POOLVR.onTable=[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],POOLVR.nextBall=1;var floorBody,ceilingBody,basicMaterials={},nonbasicMaterials={};scene.traverse(function(node){if(node instanceof THREE.Mesh){if((node.material instanceof THREE.MeshLambertMaterial||node.material instanceof THREE.MeshPhongMaterial)&&void 0===basicMaterials[node.material.uuid]){var basicMaterial=new THREE.MeshBasicMaterial({color:node.material.color.getHex(),transparent:node.material.transparent,side:node.material.side});basicMaterials[node.material.uuid]=basicMaterial,nonbasicMaterials[basicMaterial.uuid]=node.material}var ballNum;node.name.startsWith("ballMesh")?(ballNum=Number(node.name.split(" ")[1]),POOLVR.ballMeshes[ballNum]=node,POOLVR.ballBodies[ballNum]=node.body,POOLVR.initialPositions[ballNum]=(new THREE.Vector3).copy(node.position),node.body.bounces=0,node.body.ballNum=ballNum,node.body.material=POOLVR.ballMaterial):"playableSurfaceMesh"===node.name?node.body.material=POOLVR.playableSurfaceMaterial:node.name.endsWith("CushionMesh")?node.body.material=POOLVR.cushionMaterial:"floorMesh"===node.name?(floorBody=node.body,floorBody.material=POOLVR.floorMaterial):"ceilingMesh"===node.name?(ceilingBody=node.body,ceilingBody.material=POOLVR.floorMaterial):node.name.endsWith("RailMesh")&&(node.body.material=POOLVR.railMaterial)}}),POOLVR.switchMaterials=function(useBasicMaterials){var materials=useBasicMaterials?basicMaterials:nonbasicMaterials;POOLVR.app.scene.traverse(function(node){if(node instanceof THREE.Mesh){var material=node.material,uuid=material.uuid;materials[uuid]&&(node.material=materials[uuid])}})};var H_table=POOLVR.config.H_table;if(!POOLVR.config.useShadowMap){var ballShadowMeshes=[],ballShadowGeom=new THREE.CircleBufferGeometry(.5*POOLVR.config.ball_diameter,16);ballShadowGeom.rotateX(-.5*Math.PI),POOLVR.ballMeshes.forEach(function(mesh,ballNum){var ballShadowMesh=new THREE.Mesh(ballShadowGeom,POOLVR.shadowMaterial);ballShadowMesh.position.copy(mesh.position),ballShadowMesh.position.y=H_table+4e-4,ballShadowMeshes[ballNum]=ballShadowMesh,scene.add(ballShadowMesh)})}POOLVR.updateBallsPostStep=function(){for(var i=0;i<POOLVR.ballMeshes.length;i++){var mesh=POOLVR.ballMeshes[i],body=POOLVR.ballBodies[i];if(mesh.position.copy(body.interpolatedPosition),mesh.quaternion.copy(body.interpolatedQuaternion),mesh.updateMatrix(),mesh.updateMatrixWorld(),!POOLVR.config.useShadowMap){var shadowMesh=ballShadowMeshes[i];shadowMesh.position.x=mesh.position.x,shadowMesh.position.z=mesh.position.z,shadowMesh.updateMatrix(),shadowMesh.updateMatrixWorld()}}},floorBody.addEventListener(CANNON.Body.COLLIDE_EVENT_NAME,function(evt){var body=evt.body;0===body.ballNum?(POOLVR.textGeomLogger.log("SCRATCH."),POOLVR.synthSpeaker.speak("Scratch."),body.position.copy(POOLVR.initialPositions[0]),body.velocity.set(0,0,0),body.angularVelocity.set(0,0,0)):void 0!==body.ballNum&&(body.bounces++,1===body.bounces?(POOLVR.playPocketedSound(),POOLVR.onTable[body.ballNum]=!1,POOLVR.nextBall=POOLVR.onTable.slice(1).indexOf(!0)+1,0===POOLVR.nextBall&&(POOLVR.synthSpeaker.speak("You cleared the table.  Well done."),POOLVR.textGeomLogger.log("YOU CLEARED THE TABLE.  WELL DONE."),POOLVR.resetTable())):7===body.bounces&&(body.sleep(),body.mesh.visible=!1))});var relVelocity=new CANNON.Vec3,tipCollisionCounter=0;world.addEventListener("beginContact",function(evt){var bodyA=evt.bodyA,bodyB=evt.bodyB;bodyA.material===bodyB.material?(bodyA.velocity.vsub(bodyB.velocity,relVelocity),POOLVR.playCollisionSound(relVelocity.lengthSquared())):bodyA.material===POOLVR.openVRTipMaterial&&bodyB.material===POOLVR.ballMaterial&&POOLVR.openVRTool.body.sleepState===CANNON.Body.AWAKE&&(POOLVR.openVRTool.body.sleep(),setTimeout(POOLVR.openVRTool.body.wakeUp,500),tipCollisionCounter++,1===tipCollisionCounter?POOLVR.synthSpeaker.speak("You moved a ball.  Good job."):16===tipCollisionCounter&&POOLVR.synthSpeaker.speak("You are doing a great job."))}),POOLVR.stage.load(POOLVR.config.stage),scene.updateMatrixWorld(!0),POOLVR.leapTool.updateToolMapping(),POOLVR.switchMaterials(POOLVR.config.useBasicMaterials),POOLVR.startAnimateLoop()})},POOLVR.moveAvatar=function(){"use strict";var UP=THREE.Object3D.DefaultUp,walkSpeed=.333,floatSpeed=.1,euler=new THREE.Euler(0,0,0,"YXZ");return function(keyboard,gamepadValues,dt){for(var avatar=POOLVR.avatar,floatUp=keyboard.floatUp-keyboard.floatDown,drive=keyboard.driveBack-keyboard.driveForward,strafe=keyboard.strafeRight-keyboard.strafeLeft,heading=-.8*dt*(-keyboard.turnLeft+keyboard.turnRight),i=0;i<gamepadValues.length;i++){var values=gamepadValues[i];values.toggleFloatMode?(values.moveFB&&(floatUp-=values.moveFB),values.turnLR&&(strafe+=values.turnLR)):(values.moveFB&&(drive+=values.moveFB),values.turnLR&&(heading+=-.8*dt*values.turnLR))}if(floatUp*=floatSpeed,strafe||drive){var len=walkSpeed*Math.min(1,1/Math.sqrt(drive*drive+strafe*strafe));strafe*=len,drive*=len}else strafe=0,drive=0;if(0!==floatUp||0!==strafe||0!==heading||0!==drive){euler.setFromQuaternion(avatar.quaternion),euler.y+=heading;var cosHeading=Math.cos(euler.y),sinHeading=Math.sin(euler.y);avatar.quaternion.setFromAxisAngle(UP,euler.y),avatar.position.x+=dt*(strafe*cosHeading+drive*sinHeading),avatar.position.z+=dt*(drive*cosHeading-strafe*sinHeading),avatar.position.y+=dt*floatUp,avatar.updateMatrix()}}}(),POOLVR.moveToolRoot=function(){"use strict";var UP=THREE.Object3D.DefaultUp,euler=new THREE.Euler(0,0,0,"YXZ");return function(keyboard,gamepadValues,dt){var leapTool=POOLVR.leapTool,toolRoot=leapTool.toolRoot,toolDrive=0,toolFloat=0,toolStrafe=0,rotateToolCW=0;keyboard&&(toolDrive+=keyboard.moveToolForwards-keyboard.moveToolBackwards,toolFloat+=keyboard.moveToolUp-keyboard.moveToolDown,toolStrafe+=keyboard.moveToolRight-keyboard.moveToolLeft,rotateToolCW+=keyboard.rotateToolCW-keyboard.rotateToolCCW);for(var i=0;i<gamepadValues.length;i++){var values=gamepadValues[i];values.toggleToolFloatMode?(values.toolMoveFB&&(toolFloat-=values.toolMoveFB),values.toolTurnLR&&(toolStrafe+=values.toolTurnLR)):(values.toolMoveFB&&(toolDrive-=values.toolMoveFB),values.toolTurnLR&&(rotateToolCW+=values.toolTurnLR))}0===toolDrive&&0===toolStrafe&&0===toolFloat&&0===rotateToolCW||(toolRoot.position.x+=.16*dt*toolStrafe,toolRoot.position.z+=-.16*dt*toolDrive,toolRoot.position.y+=.16*dt*toolFloat,euler.setFromQuaternion(toolRoot.quaternion),euler.y-=.15*dt*rotateToolCW,toolRoot.quaternion.setFromAxisAngle(UP,euler.y),toolRoot.updateMatrix(),leapTool.setDeadtime(0))}}(),POOLVR.startTutorial=function(){"use strict";POOLVR.synthSpeaker.speak("Hello.  Welcome. To. Pool-ver.",function(){POOLVR.textGeomLogger.log("HELLO.  WELCOME TO POOLVR.")}),POOLVR.synthSpeaker.speak("Please wave a stick-like object in front of your Leap Motion controller.",function(){POOLVR.textGeomLogger.log("PLEASE WAVE A STICK-LIKE OBJECT IN FRONT OF YOUR"),POOLVR.textGeomLogger.log("LEAP MOTION CONTROLLER.")}),POOLVR.synthSpeaker.speak("Keep the stick within the interaction box when you want to make contact with.  A ball.",function(){POOLVR.textGeomLogger.log("KEEP THE STICK WITHIN THE INTERACTION BOX WHEN YOU WANT"),POOLVR.textGeomLogger.log("TO MAKE CONTACT WITH A BALL...")}),POOLVR.synthSpeaker.speak("If you are playing in VR, try using the I, J, K, and L keys.  To move the virtual. Leap Motion Controller.  So that it coincides with the controller in your physical environment.",function(){POOLVR.textGeomLogger.log("IF YOU ARE PLAYING IN VR, TRY USING THE"),POOLVR.textGeomLogger.log("I / J / K / L / O / . / Y / U KEYS"),POOLVR.textGeomLogger.log("TO MOVE THE VIRTUAL LEAP MOTION CONTROLLER"),POOLVR.textGeomLogger.log("SO THAT IT COINCIDES WITH THE CONTROLLER"),POOLVR.textGeomLogger.log("IN YOUR PHYSICAL ENVIRONMENT.")})},POOLVR.startAnimateLoop=function(){"use strict";function animate(t){var dt=.001*(t-lt);POOLVR.textGeomLogger.update(t),updateTool(dt),POOLVR.openVRTool&&POOLVR.openVRTool.update(dt),app.render(),world.step(Math.min(1/60,dt),dt,10),updateToolPostStep(),updateBallsPostStep();var gamepadValues=YAWVRB.Gamepads.update();moveAvatar(keyboard,gamepadValues,dt),moveToolRoot(keyboard,gamepadValues,dt),avatar.updateMatrixWorld(),updateToolMapping(),lt=t,requestAnimationFrame(animate)}var keyboard=POOLVR.keyboard,app=POOLVR.app,world=POOLVR.world,avatar=POOLVR.avatar,updateTool=POOLVR.leapTool.updateTool,updateToolPostStep=POOLVR.leapTool.updateToolPostStep,updateToolMapping=POOLVR.leapTool.updateToolMapping,updateBallsPostStep=POOLVR.updateBallsPostStep,moveToolRoot=POOLVR.moveToolRoot,moveAvatar=POOLVR.moveAvatar,lt=0;requestAnimationFrame(animate)}},{"./actions.js":1,"./config.js":2,"./menu.js":4,"./sounds.js":5}],4:[function(require,module,exports){POOLVR.setupMenu=function(){"use strict";function onFocus(){POOLVR.keyboard.enabled=!1}function onBlur(){POOLVR.keyboard.enabled=!0}function onLeapAddressChange(){var host=leapAddressInput.value;POOLVR.config.toolOptions.host=host,POOLVR.leapTool.leapController.connection.host=host,POOLVR.leapTool.leapController.connection.disconnect(!0),POOLVR.leapTool.leapController.connect()}var overlay=document.getElementById("overlay");POOLVR.toggleMenu=function(){"none"===overlay.style.display?overlay.style.display="block":overlay.style.display="none"};for(var inputs=document.querySelectorAll("input"),i=0;i<inputs.length;i++)inputs[i].addEventListener("focus",onFocus,!1),inputs[i].addEventListener("blur",onBlur,!1);var useBasicMaterialsInput=document.getElementById("useBasicMaterials");useBasicMaterialsInput.checked=POOLVR.config.useBasicMaterials;var useShadowMapInput=document.getElementById("useShadowMap");useShadowMapInput.checked=POOLVR.config.useShadowMap;var usePointLightInput=document.getElementById("usePointLight");usePointLightInput.checked=POOLVR.config.usePointLight;var useSpotLightInput=document.getElementById("useSpotLight");useSpotLightInput.checked=POOLVR.config.useSpotLight,useBasicMaterialsInput.addEventListener("change",function(){POOLVR.config.useBasicMaterials=useBasicMaterialsInput.checked,POOLVR.saveConfig(POOLVR.profile),POOLVR.config.useBasicMaterials||POOLVR.config.useSpotLight||POOLVR.config.usePointLight||(useSpotLightInput.checked=!0,POOLVR.config.useSpotLight=!0,POOLVR.centerSpotLight.visible=!0),POOLVR.switchMaterials(POOLVR.config.useBasicMaterials)},!1),useShadowMapInput.addEventListener("change",function(){POOLVR.config.useShadowMap=useShadowMapInput.checked,POOLVR.saveConfig(POOLVR.profile),window.confirm("This change requires a page reload to take effect - reload now?")&&document.location.reload()},!1),usePointLightInput.addEventListener("change",function(){POOLVR.config.usePointLight=usePointLightInput.checked,POOLVR.saveConfig(POOLVR.profile),window.confirm("This change requires a page reload to take effect - reload now?")&&document.location.reload()},!1),useSpotLightInput.addEventListener("change",function(){POOLVR.config.useSpotLight=useSpotLightInput.checked,POOLVR.saveConfig(POOLVR.profile),POOLVR.centerSpotLight.visible=POOLVR.config.useSpotLight},!1);var leapAddressInput=document.getElementById("leapAddress");leapAddressInput.value=POOLVR.config.toolOptions.host||"127.0.0.1",leapAddressInput.addEventListener("change",onLeapAddressChange,!1);var profileNameInput=document.getElementById("profileName");POOLVR.profile=profileNameInput.value||"default",profileNameInput.value=POOLVR.profile,profileNameInput.addEventListener("change",function(){POOLVR.profile=profileNameInput.value},!1);var vrButton=document.getElementById("vrButton");vrButton.addEventListener("click",function(){POOLVR.app.toggleVR(),vrButton.blur(),overlay.style.display="none"},!1);var fsButton=document.getElementById("fsButton");fsButton.addEventListener("click",function(){POOLVR.app.toggleFullscreen()},!1);var saveProfileButton=document.getElementById("saveProfileButton");saveProfileButton.addEventListener("click",function(){POOLVR.saveConfig(POOLVR.profile)},!1);var loadProfileButton=document.getElementById("loadProfileButton");loadProfileButton.addEventListener("click",function(){var config=POOLVR.loadConfig(POOLVR.profile);config&&(console.log('loaded configuration for "%s":',POOLVR.profile),console.log(JSON.stringify(config,void 0,2)),POOLVR.config=config,POOLVR.stage.load(POOLVR.config.stage))},!1);var vrDisplay=null;navigator.getVRDisplays?navigator.getVRDisplays().then(function(vrDisplays){for(var i=0;i<vrDisplays.length;i++)if(console.log(vrDisplays[i]),vrDisplays[i].capabilities&&vrDisplays[i].capabilities.canPresent){vrDisplay=vrDisplays[i];break}vrDisplay||(vrButton.style.display="none",vrButton.disabled=!0)})["catch"](function(err){vrButton.style.display="none",vrButton.disabled=!0,console.error(err)}):(vrButton.style.display="none",vrButton.disabled=!0,console.warn("navigator does not provide getVRDisplays"))}},{}],5:[function(require,module,exports){POOLVR.playCollisionSound=function(){"use strict";var ballBallBuffer,filename=/Edge/.test(navigator.userAgent)?"sounds/ballBall.mp3":"sounds/ballBall.ogg";YAWVRB.Audio.loadBuffer(filename,function(buffer){ballBallBuffer=buffer});var playCollisionSound=function(v){YAWVRB.Audio.playBuffer(ballBallBuffer,Math.min(1,v/10))};return playCollisionSound}(),POOLVR.playPocketedSound=function(){"use strict";var ballPocketedBuffer,filename=/Edge/.test(navigator.userAgent)?"sounds/ballPocketed.mp3":"sounds/ballPocketed.ogg";YAWVRB.Audio.loadBuffer(filename,function(buffer){ballPocketedBuffer=buffer});var playPocketedSound=function(){YAWVRB.Audio.playBuffer(ballPocketedBuffer,.5)};return playPocketedSound}()},{}]},{},[3]);
